/**
 * @fileoverview added by tsickle
 * Generated from: lib/swal-portal.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ApplicationRef, ComponentFactoryResolver, Directive, Host, Injector, Input, TemplateRef } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { SwalPortalTargets } from './swal-portal-targets.service';
import { SwalPortalComponent } from './swal-portal.component';
import { SwalComponent } from './swal.component';
import { SweetAlert2LoaderService } from './sweetalert2-loader.service';
/**
 * A structural directive that lets you use Angular templates inside of SweetAlerts.
 * There are different targetable zones provided by {\@link SwalPortalTargets}: title, content, confirmButton, etc, but
 * you can also make your own target by implementing {\@link SwalPortalTarget} and giving it to this directive.
 * The default target is the alert text content zone.
 *
 * Usage in your component's TypeScript (if you use another target than {\@link SwalPortalTargets.content}):
 *
 * \@Component({ ... })
 *     export class MyComponent {
 *         public constructor(public readonly swalTargets: SwalPortalTargets) {
 *         }
 *     }
 *
 * Usage in the template:
 *
 *     <swal title="Fill the form" (confirm)="confirmHandler()">
 *         <!-- This form will be displayed as the alert main content
 *              Targets the alert's main content zone by default -->
 *         <form *swalPortal [formControl]="myForm">
 *             ...
 *         </form>
 *
 *         <!-- This targets the confirm button's inner content
 *              Notice the usage of ng-container to avoid creating an useless DOM element inside the button -->
 *         <ng-container *swalPortal="swalTargets.confirmButton">
 *              Send ({{ secondsLeft }} seconds left)
 *         </ng-container>
 *     <swal>
 */
export class SwalPortalDirective {
    /**
     * @param {?} resolver
     * @param {?} injector
     * @param {?} app
     * @param {?} templateRef
     * @param {?} sweetAlert2Loader
     * @param {?} swalTargets
     * @param {?} swalComponent
     */
    constructor(resolver, injector, app, templateRef, sweetAlert2Loader, swalTargets, swalComponent) {
        this.resolver = resolver;
        this.injector = injector;
        this.app = app;
        this.templateRef = templateRef;
        this.sweetAlert2Loader = sweetAlert2Loader;
        this.swalTargets = swalTargets;
        this.swalComponent = swalComponent;
        this.destroyed = new Subject();
    }
    /**
     * Subscribes to the the SweetAlert appearance/disappearance events to create/destroy the SwalPortalComponent
     * that will receive the consumer's template.
     * @return {?}
     */
    ngOnInit() {
        // Can't be set in a default property value, if the customer lets *swalPortal empty, the value we get is undef.
        this.target = this.target || this.swalTargets.content;
        //=> Apply the options provided by the target definition
        void this.swalComponent.update(this.target.options);
        //=> Subscribe to a few hooks frm the parent SwalComponent.
        this.swalComponent.render.pipe(takeUntil(this.destroyed)).subscribe(this.renderHook.bind(this));
        this.swalComponent.beforeOpen.pipe(takeUntil(this.destroyed)).subscribe(this.beforeOpenHook.bind(this));
        this.swalComponent.afterClose.pipe(takeUntil(this.destroyed)).subscribe(this.afterCloseHook.bind(this));
    }
    /**
     * Signal any {\@link destroyed} consumer that this is over, so they can unsubscribe from the
     * parent SwalComponent events.
     * @return {?}
     */
    ngOnDestroy() {
        this.destroyed.next();
    }
    /**
     * This render hook runs 1..n times (per modal instance), just before the modal is shown (and also before the
     * {\@link beforeOpenHook}), or after Swal.update() is called.
     * This is a good place to render, or re-render, our portal contents.
     * @private
     * @return {?}
     */
    renderHook() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            //=> Ensure the portal component is created
            if (!this.portalComponentRef) {
                this.portalComponentRef = this.createPortalComponent();
            }
            //=> SweetAlert2 created the modal or just erased all of our content, so we need to install/reinstall it.
            // Swal.update() is synchronous, this observable too, and mountComponentOnTarget too (the promise inside
            // this function is already resolved at this point), so the whole process of re-rendering and re-mounting
            // the portal component is fully synchronous, causing no blinks in the modal contents.
            /** @type {?} */
            const swal = yield this.sweetAlert2Loader.swal;
            //=> Find target element
            /** @type {?} */
            const targetEl = (/** @type {?} */ (this.target)).element(swal);
            //=> Replace target's contents with our component
            // https://jsperf.com/innerhtml-vs-removechild/15
            while (targetEl.firstChild) {
                targetEl.removeChild(targetEl.firstChild);
            }
            targetEl.appendChild(this.portalComponentRef.location.nativeElement);
        });
    }
    /**
     * This beforeOpen hook runs once (per modal instance), just before the modal is shown on the screen.
     * This is a good place to declare our detached view to the Angular app.
     * @private
     * @return {?}
     */
    beforeOpenHook() {
        if (!this.portalComponentRef)
            return;
        //=> Make the Angular app aware of that detached view so rendering and change detection can happen
        this.app.attachView(this.portalComponentRef.hostView);
    }
    /**
     * This afterClose hook runs once (per modal instance), just after the modal closing animation terminated.
     * This is a good place to detach and destroy our content, that is not visible anymore.
     * @private
     * @return {?}
     */
    afterCloseHook() {
        if (!this.portalComponentRef)
            return;
        //=> Detach the portal component from the app and destroy it
        this.app.detachView(this.portalComponentRef.hostView);
        this.portalComponentRef.destroy();
        this.portalComponentRef = void 0;
    }
    /**
     * Creates the {\@link SwalPortalComponent} and gives it the customer's template ref.
     * @private
     * @return {?}
     */
    createPortalComponent() {
        //=> Create the SwalPortalComponent that will hold our content
        /** @type {?} */
        const factory = this.resolver.resolveComponentFactory(SwalPortalComponent);
        // Yes, we do not use the third argument that would directly use the target as the component's view
        // (unfortunately, because that would give a cleaner DOM and would avoid dirty and direct DOM manipulations)
        // That's because we want to keep our component safe from SweetAlert2's operations on the DOM, and to be
        // able to restore it at any moment, ie. after the modal has been re-rendered.
        /** @type {?} */
        const componentRef = factory.create(this.injector, []);
        //=> Apply the consumer's template on the component
        componentRef.instance.template = this.templateRef;
        return componentRef;
    }
}
SwalPortalDirective.decorators = [
    { type: Directive, args: [{
                selector: '[swalPortal]'
            },] }
];
/** @nocollapse */
SwalPortalDirective.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: ApplicationRef },
    { type: TemplateRef },
    { type: SweetAlert2LoaderService },
    { type: SwalPortalTargets },
    { type: SwalComponent, decorators: [{ type: Host }] }
];
SwalPortalDirective.propDecorators = {
    target: [{ type: Input, args: ['swalPortal',] }]
};
if (false) {
    /**
     * Takes a portal target or nothing (then it will target the text content zone by default).
     *
     * See the {\@link SwalPortalTargets} service to see the available targets.
     * See the class doc block for more informations.
     * @type {?}
     */
    SwalPortalDirective.prototype.target;
    /**
     * Holds the component reference of the controlled SwalPortalComponent to destroy it when no longer needed.
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.portalComponentRef;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.destroyed;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.app;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.templateRef;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.sweetAlert2Loader;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.swalTargets;
    /**
     * @type {?}
     * @private
     */
    SwalPortalDirective.prototype.swalComponent;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dhbC1wb3J0YWwuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHN3ZWV0YWxlcnQyL25neC1zd2VldGFsZXJ0Mi8iLCJzb3VyY2VzIjpbImxpYi9zd2FsLXBvcnRhbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUNILGNBQWMsRUFBRSx3QkFBd0IsRUFBZ0IsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUN4RixXQUFXLEVBQ2QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFvQixpQkFBaUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3BGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzlELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1DeEUsTUFBTSxPQUFPLG1CQUFtQjs7Ozs7Ozs7OztJQWdCNUIsWUFDcUIsUUFBa0MsRUFDbEMsUUFBa0IsRUFDbEIsR0FBbUIsRUFDbkIsV0FBNkIsRUFDN0IsaUJBQTJDLEVBQzNDLFdBQThCLEVBQ3RCLGFBQTRCO1FBTnBDLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsUUFBRyxHQUFILEdBQUcsQ0FBZ0I7UUFDbkIsZ0JBQVcsR0FBWCxXQUFXLENBQWtCO1FBQzdCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMEI7UUFDM0MsZ0JBQVcsR0FBWCxXQUFXLENBQW1CO1FBQ3RCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBVHhDLGNBQVMsR0FB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USxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFFbEQsT0FBTyxZQUFZLENBQUM7SUFDeEIsQ0FBQzs7O1lBNUhKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsY0FBYzthQUMzQjs7OztZQTFDbUIsd0JBQXdCO1lBQWlDLFFBQVE7WUFBakYsY0FBYztZQUNkLFdBQVc7WUFPTix3QkFBd0I7WUFITixpQkFBaUI7WUFFbkMsYUFBYSx1QkEyRGIsSUFBSTs7O3FCQWhCUixLQUFLLFNBQUMsWUFBWTs7Ozs7Ozs7OztJQUFuQixxQ0FBc0Q7Ozs7OztJQUt0RCxpREFBK0Q7Ozs7O0lBRS9ELHdDQUFpRDs7Ozs7SUFHN0MsdUNBQW1EOzs7OztJQUNuRCx1Q0FBbUM7Ozs7O0lBQ25DLGtDQUFvQzs7Ozs7SUFDcEMsMENBQThDOzs7OztJQUM5QyxnREFBNEQ7Ozs7O0lBQzVELDBDQUErQzs7Ozs7SUFDL0MsNENBQXFEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBBcHBsaWNhdGlvblJlZiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIERpcmVjdGl2ZSwgSG9zdCwgSW5qZWN0b3IsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCxcbiAgICBUZW1wbGF0ZVJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFN3YWxQb3J0YWxUYXJnZXQsIFN3YWxQb3J0YWxUYXJnZXRzIH0gZnJvbSAnLi9zd2FsLXBvcnRhbC10YXJnZXRzLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3dhbFBvcnRhbENvbXBvbmVudCB9IGZyb20gJy4vc3dhbC1wb3J0YWwuY29tcG9uZW50JztcbmltcG9ydCB7IFN3YWxDb21wb25lbnQgfSBmcm9tICcuL3N3YWwuY29tcG9uZW50JztcbmltcG9ydCB7IFN3ZWV0QWxlcnQyTG9hZGVyU2VydmljZSB9IGZyb20gJy4vc3dlZXRhbGVydDItbG9hZGVyLnNlcnZpY2UnO1xuXG4vKipcbiAqIEEgc3RydWN0dXJhbCBkaXJlY3RpdmUgdGhhdCBsZXRzIHlvdSB1c2UgQW5ndWxhciB0ZW1wbGF0ZXMgaW5zaWRlIG9mIFN3ZWV0QWxlcnRzLlxuICogVGhlcmUgYXJlIGRpZmZlcmVudCB0YXJnZXRhYmxlIHpvbmVzIHByb3ZpZGVkIGJ5IHtAbGluayBTd2FsUG9ydGFsVGFyZ2V0c306IHRpdGxlLCBjb250ZW50LCBjb25maXJtQnV0dG9uLCBldGMsIGJ1dFxuICogeW91IGNhbiBhbHNvIG1ha2UgeW91ciBvd24gdGFyZ2V0IGJ5IGltcGxlbWVudGluZyB7QGxpbmsgU3dhbFBvcnRhbFRhcmdldH0gYW5kIGdpdmluZyBpdCB0byB0aGlzIGRpcmVjdGl2ZS5cbiAqIFRoZSBkZWZhdWx0IHRhcmdldCBpcyB0aGUgYWxlcnQgdGV4dCBjb250ZW50IHpvbmUuXG4gKlxuICogVXNhZ2UgaW4geW91ciBjb21wb25lbnQncyBUeXBlU2NyaXB0IChpZiB5b3UgdXNlIGFub3RoZXIgdGFyZ2V0IHRoYW4ge0BsaW5rIFN3YWxQb3J0YWxUYXJnZXRzLmNvbnRlbnR9KTpcbiAqXG4gKiAgICAgQENvbXBvbmVudCh7IC4uLiB9KVxuICogICAgIGV4cG9ydCBjbGFzcyBNeUNvbXBvbmVudCB7XG4gKiAgICAgICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihwdWJsaWMgcmVhZG9ubHkgc3dhbFRhcmdldHM6IFN3YWxQb3J0YWxUYXJnZXRzKSB7XG4gKiAgICAgICAgIH1cbiAqICAgICB9XG4gKlxuICogVXNhZ2UgaW4gdGhlIHRlbXBsYXRlOlxuICpcbiAqICAgICA8c3dhbCB0aXRsZT1cIkZpbGwgdGhlIGZvcm1cIiAoY29uZmlybSk9XCJjb25maXJtSGFuZGxlcigpXCI+XG4gKiAgICAgICAgIDwhLS0gVGhpcyBmb3JtIHdpbGwgYmUgZGlzcGxheWVkIGFzIHRoZSBhbGVydCBtYWluIGNvbnRlbnRcbiAqICAgICAgICAgICAgICBUYXJnZXRzIHRoZSBhbGVydCdzIG1haW4gY29udGVudCB6b25lIGJ5IGRlZmF1bHQgLS0+XG4gKiAgICAgICAgIDxmb3JtICpzd2FsUG9ydGFsIFtmb3JtQ29udHJvbF09XCJteUZvcm1cIj5cbiAqICAgICAgICAgICAgIC4uLlxuICogICAgICAgICA8L2Zvcm0+XG4gKlxuICogICAgICAgICA8IS0tIFRoaXMgdGFyZ2V0cyB0aGUgY29uZmlybSBidXR0b24ncyBpbm5lciBjb250ZW50XG4gKiAgICAgICAgICAgICAgTm90aWNlIHRoZSB1c2FnZSBvZiBuZy1jb250YWluZXIgdG8gYXZvaWQgY3JlYXRpbmcgYW4gdXNlbGVzcyBET00gZWxlbWVudCBpbnNpZGUgdGhlIGJ1dHRvbiAtLT5cbiAqICAgICAgICAgPG5nLWNvbnRhaW5lciAqc3dhbFBvcnRhbD1cInN3YWxUYXJnZXRzLmNvbmZpcm1CdXR0b25cIj5cbiAqICAgICAgICAgICAgICBTZW5kICh7eyBzZWNvbmRzTGVmdCB9fSBzZWNvbmRzIGxlZnQpXG4gKiAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICogICAgIDxzd2FsPlxuICovXG5ARGlyZWN0aXZlKHtcbiAgICBzZWxlY3RvcjogJ1tzd2FsUG9ydGFsXSdcbn0pXG5leHBvcnQgY2xhc3MgU3dhbFBvcnRhbERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICAvKipcbiAgICAgKiBUYWtlcyBhIHBvcnRhbCB0YXJnZXQgb3Igbm90aGluZyAodGhlbiBpdCB3aWxsIHRhcmdldCB0aGUgdGV4dCBjb250ZW50IHpvbmUgYnkgZGVmYXVsdCkuXG4gICAgICpcbiAgICAgKiBTZWUgdGhlIHtAbGluayBTd2FsUG9ydGFsVGFyZ2V0c30gc2VydmljZSB0byBzZWUgdGhlIGF2YWlsYWJsZSB0YXJnZXRzLlxuICAgICAqIFNlZSB0aGUgY2xhc3MgZG9jIGJsb2NrIGZvciBtb3JlIGluZm9ybWF0aW9ucy5cbiAgICAgKi9cbiAgICBASW5wdXQoJ3N3YWxQb3J0YWwnKSBwdWJsaWMgdGFyZ2V0PzogU3dhbFBvcnRhbFRhcmdldDtcblxuICAgIC8qKlxuICAgICAqIEhvbGRzIHRoZSBjb21wb25lbnQgcmVmZXJlbmNlIG9mIHRoZSBjb250cm9sbGVkIFN3YWxQb3J0YWxDb21wb25lbnQgdG8gZGVzdHJveSBpdCB3aGVuIG5vIGxvbmdlciBuZWVkZWQuXG4gICAgICovXG4gICAgcHJpdmF0ZSBwb3J0YWxDb21wb25lbnRSZWY/OiBDb21wb25lbnRSZWY8U3dhbFBvcnRhbENvbXBvbmVudD47XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3llZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYXBwOiBBcHBsaWNhdGlvblJlZixcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PixcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBzd2VldEFsZXJ0MkxvYWRlcjogU3dlZXRBbGVydDJMb2FkZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHN3YWxUYXJnZXRzOiBTd2FsUG9ydGFsVGFyZ2V0cyxcbiAgICAgICAgQEhvc3QoKSBwcml2YXRlIHJlYWRvbmx5IHN3YWxDb21wb25lbnQ6IFN3YWxDb21wb25lbnQpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVzIHRvIHRoZSB0aGUgU3dlZXRBbGVydCBhcHBlYXJhbmNlL2Rpc2FwcGVhcmFuY2UgZXZlbnRzIHRvIGNyZWF0ZS9kZXN0cm95IHRoZSBTd2FsUG9ydGFsQ29tcG9uZW50XG4gICAgICogdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGNvbnN1bWVyJ3MgdGVtcGxhdGUuXG4gICAgICovXG4gICAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICAvLyBDYW4ndCBiZSBzZXQgaW4gYSBkZWZhdWx0IHByb3BlcnR5IHZhbHVlLCBpZiB0aGUgY3VzdG9tZXIgbGV0cyAqc3dhbFBvcnRhbCBlbXB0eSwgdGhlIHZhbHVlIHdlIGdldCBpcyB1bmRlZi5cbiAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLnRhcmdldCB8fCB0aGlzLnN3YWxUYXJnZXRzLmNvbnRlbnQ7XG5cbiAgICAgICAgLy89PiBBcHBseSB0aGUgb3B0aW9ucyBwcm92aWRlZCBieSB0aGUgdGFyZ2V0IGRlZmluaXRpb25cbiAgICAgICAgdm9pZCB0aGlzLnN3YWxDb21wb25lbnQudXBkYXRlKHRoaXMudGFyZ2V0Lm9wdGlvbnMpO1xuXG4gICAgICAgIC8vPT4gU3Vic2NyaWJlIHRvIGEgZmV3IGhvb2tzIGZybSB0aGUgcGFyZW50IFN3YWxDb21wb25lbnQuXG4gICAgICAgIHRoaXMuc3dhbENvbXBvbmVudC5yZW5kZXIucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95ZWQpKS5zdWJzY3JpYmUodGhpcy5yZW5kZXJIb29rLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnN3YWxDb21wb25lbnQuYmVmb3JlT3Blbi5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCkpLnN1YnNjcmliZSh0aGlzLmJlZm9yZU9wZW5Ib29rLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnN3YWxDb21wb25lbnQuYWZ0ZXJDbG9zZS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCkpLnN1YnNjcmliZSh0aGlzLmFmdGVyQ2xvc2VIb29rLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpZ25hbCBhbnkge0BsaW5rIGRlc3Ryb3llZH0gY29uc3VtZXIgdGhhdCB0aGlzIGlzIG92ZXIsIHNvIHRoZXkgY2FuIHVuc3Vic2NyaWJlIGZyb20gdGhlXG4gICAgICogcGFyZW50IFN3YWxDb21wb25lbnQgZXZlbnRzLlxuICAgICAqL1xuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kZXN0cm95ZWQubmV4dCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgcmVuZGVyIGhvb2sgcnVucyAxLi5uIHRpbWVzIChwZXIgbW9kYWwgaW5zdGFuY2UpLCBqdXN0IGJlZm9yZSB0aGUgbW9kYWwgaXMgc2hvd24gKGFuZCBhbHNvIGJlZm9yZSB0aGVcbiAgICAgKiB7QGxpbmsgYmVmb3JlT3Blbkhvb2t9KSwgb3IgYWZ0ZXIgU3dhbC51cGRhdGUoKSBpcyBjYWxsZWQuXG4gICAgICogVGhpcyBpcyBhIGdvb2QgcGxhY2UgdG8gcmVuZGVyLCBvciByZS1yZW5kZXIsIG91ciBwb3J0YWwgY29udGVudHMuXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyByZW5kZXJIb29rKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICAvLz0+IEVuc3VyZSB0aGUgcG9ydGFsIGNvbXBvbmVudCBpcyBjcmVhdGVkXG4gICAgICAgIGlmICghdGhpcy5wb3J0YWxDb21wb25lbnRSZWYpIHtcbiAgICAgICAgICAgIHRoaXMucG9ydGFsQ29tcG9uZW50UmVmID0gdGhpcy5jcmVhdGVQb3J0YWxDb21wb25lbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT4gU3dlZXRBbGVydDIgY3JlYXRlZCB0aGUgbW9kYWwgb3IganVzdCBlcmFzZWQgYWxsIG9mIG91ciBjb250ZW50LCBzbyB3ZSBuZWVkIHRvIGluc3RhbGwvcmVpbnN0YWxsIGl0LlxuICAgICAgICAvLyBTd2FsLnVwZGF0ZSgpIGlzIHN5bmNocm9ub3VzLCB0aGlzIG9ic2VydmFibGUgdG9vLCBhbmQgbW91bnRDb21wb25lbnRPblRhcmdldCB0b28gKHRoZSBwcm9taXNlIGluc2lkZVxuICAgICAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzIGFscmVhZHkgcmVzb2x2ZWQgYXQgdGhpcyBwb2ludCksIHNvIHRoZSB3aG9sZSBwcm9jZXNzIG9mIHJlLXJlbmRlcmluZyBhbmQgcmUtbW91bnRpbmdcbiAgICAgICAgLy8gdGhlIHBvcnRhbCBjb21wb25lbnQgaXMgZnVsbHkgc3luY2hyb25vdXMsIGNhdXNpbmcgbm8gYmxpbmtzIGluIHRoZSBtb2RhbCBjb250ZW50cy5cbiAgICAgICAgY29uc3Qgc3dhbCA9IGF3YWl0IHRoaXMuc3dlZXRBbGVydDJMb2FkZXIuc3dhbDtcblxuICAgICAgICAvLz0+IEZpbmQgdGFyZ2V0IGVsZW1lbnRcbiAgICAgICAgY29uc3QgdGFyZ2V0RWwgPSB0aGlzLnRhcmdldCEuZWxlbWVudChzd2FsKTtcblxuICAgICAgICAvLz0+IFJlcGxhY2UgdGFyZ2V0J3MgY29udGVudHMgd2l0aCBvdXIgY29tcG9uZW50XG4gICAgICAgIC8vIGh0dHBzOi8vanNwZXJmLmNvbS9pbm5lcmh0bWwtdnMtcmVtb3ZlY2hpbGQvMTVcbiAgICAgICAgd2hpbGUgKHRhcmdldEVsLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICAgIHRhcmdldEVsLnJlbW92ZUNoaWxkKHRhcmdldEVsLmZpcnN0Q2hpbGQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGFyZ2V0RWwuYXBwZW5kQ2hpbGQodGhpcy5wb3J0YWxDb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBiZWZvcmVPcGVuIGhvb2sgcnVucyBvbmNlIChwZXIgbW9kYWwgaW5zdGFuY2UpLCBqdXN0IGJlZm9yZSB0aGUgbW9kYWwgaXMgc2hvd24gb24gdGhlIHNjcmVlbi5cbiAgICAgKiBUaGlzIGlzIGEgZ29vZCBwbGFjZSB0byBkZWNsYXJlIG91ciBkZXRhY2hlZCB2aWV3IHRvIHRoZSBBbmd1bGFyIGFwcC5cbiAgICAgKi9cbiAgICBwcml2YXRlIGJlZm9yZU9wZW5Ib29rKCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMucG9ydGFsQ29tcG9uZW50UmVmKSByZXR1cm47XG5cbiAgICAgICAgLy89PiBNYWtlIHRoZSBBbmd1bGFyIGFwcCBhd2FyZSBvZiB0aGF0IGRldGFjaGVkIHZpZXcgc28gcmVuZGVyaW5nIGFuZCBjaGFuZ2UgZGV0ZWN0aW9uIGNhbiBoYXBwZW5cbiAgICAgICAgdGhpcy5hcHAuYXR0YWNoVmlldyh0aGlzLnBvcnRhbENvbXBvbmVudFJlZi5ob3N0Vmlldyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBhZnRlckNsb3NlIGhvb2sgcnVucyBvbmNlIChwZXIgbW9kYWwgaW5zdGFuY2UpLCBqdXN0IGFmdGVyIHRoZSBtb2RhbCBjbG9zaW5nIGFuaW1hdGlvbiB0ZXJtaW5hdGVkLlxuICAgICAqIFRoaXMgaXMgYSBnb29kIHBsYWNlIHRvIGRldGFjaCBhbmQgZGVzdHJveSBvdXIgY29udGVudCwgdGhhdCBpcyBub3QgdmlzaWJsZSBhbnltb3JlLlxuICAgICAqL1xuICAgIHByaXZhdGUgYWZ0ZXJDbG9zZUhvb2soKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5wb3J0YWxDb21wb25lbnRSZWYpIHJldHVybjtcblxuICAgICAgICAvLz0+IERldGFjaCB0aGUgcG9ydGFsIGNvbXBvbmVudCBmcm9tIHRoZSBhcHAgYW5kIGRlc3Ryb3kgaXRcbiAgICAgICAgdGhpcy5hcHAuZGV0YWNoVmlldyh0aGlzLnBvcnRhbENvbXBvbmVudFJlZi5ob3N0Vmlldyk7XG4gICAgICAgIHRoaXMucG9ydGFsQ29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5wb3J0YWxDb21wb25lbnRSZWYgPSB2b2lkIDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyB0aGUge0BsaW5rIFN3YWxQb3J0YWxDb21wb25lbnR9IGFuZCBnaXZlcyBpdCB0aGUgY3VzdG9tZXIncyB0ZW1wbGF0ZSByZWYuXG4gICAgICovXG4gICAgcHJpdmF0ZSBjcmVhdGVQb3J0YWxDb21wb25lbnQoKTogQ29tcG9uZW50UmVmPFN3YWxQb3J0YWxDb21wb25lbnQ+IHtcbiAgICAgICAgLy89PiBDcmVhdGUgdGhlIFN3YWxQb3J0YWxDb21wb25lbnQgdGhhdCB3aWxsIGhvbGQgb3VyIGNvbnRlbnRcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU3dhbFBvcnRhbENvbXBvbmVudCk7XG5cbiAgICAgICAgLy8gWWVzLCB3ZSBkbyBub3QgdXNlIHRoZSB0aGlyZCBhcmd1bWVudCB0aGF0IHdvdWxkIGRpcmVjdGx5IHVzZSB0aGUgdGFyZ2V0IGFzIHRoZSBjb21wb25lbnQncyB2aWV3XG4gICAgICAgIC8vICh1bmZvcnR1bmF0ZWx5LCBiZWNhdXNlIHRoYXQgd291bGQgZ2l2ZSBhIGNsZWFuZXIgRE9NIGFuZCB3b3VsZCBhdm9pZCBkaXJ0eSBhbmQgZGlyZWN0IERPTSBtYW5pcHVsYXRpb25zKVxuICAgICAgICAvLyBUaGF0J3MgYmVjYXVzZSB3ZSB3YW50IHRvIGtlZXAgb3VyIGNvbXBvbmVudCBzYWZlIGZyb20gU3dlZXRBbGVydDIncyBvcGVyYXRpb25zIG9uIHRoZSBET00sIGFuZCB0byBiZVxuICAgICAgICAvLyBhYmxlIHRvIHJlc3RvcmUgaXQgYXQgYW55IG1vbWVudCwgaWUuIGFmdGVyIHRoZSBtb2RhbCBoYXMgYmVlbiByZS1yZW5kZXJlZC5cbiAgICAgICAgY29uc3QgY29tcG9uZW50UmVmID0gZmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3RvciwgW10pO1xuXG4gICAgICAgIC8vPT4gQXBwbHkgdGhlIGNvbnN1bWVyJ3MgdGVtcGxhdGUgb24gdGhlIGNvbXBvbmVudFxuICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlUmVmO1xuXG4gICAgICAgIHJldHVybiBjb21wb25lbnRSZWY7XG4gICAgfVxufVxuIl19